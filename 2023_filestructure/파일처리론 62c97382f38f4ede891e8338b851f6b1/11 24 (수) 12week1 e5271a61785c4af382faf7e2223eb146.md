# 11.24.(수) 12week1

<aside>
💡 B-tree 삽입 과정

</aside>

![스크린샷 2023-11-22 14.10.48.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.10.48.png)

FindLeaf(Key) : 키를 위한 단말 노드 검색

(key, Ref) 항목을 단만 노드에 삽입

if 오버플로우가 되었다면. 스플릿 후 삽입

이 코드 보고 대충은 이해가 되어야함

![스크린샷 2023-11-22 14.19.03.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.19.03.png)

![스크린샷 2023-11-22 14.29.28.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.29.28.png)

<aside>
💡 차수

</aside>

![스크린샷 2023-11-22 14.31.18.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.31.18.png)

최초의 논문에서는 

**B-트리의 차수를 각 노드에 저장 가능한 키의 최소수 로 정의
용어의 모호성(ambiguity)**

최근에선

**B-트리의 차수를 각노드가 가질 수 있는 최대 키 개수로 정의
이전 B-트리 예제는 4의 차수를 가짐**

![스크린샷 2023-11-22 14.35.15.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.35.15.png)

차수가 M 일 경우 자손 노드들은 최소 M / 2 개가 된다.

만약 홀수라면 [M / 2 + 1]

키의 중복

- 키의 중복을 없애기 위해 B트리의 각 노드에 키와 데이터레코드에 대한 주소를 포함함
    - 장점 :  공간 절약, 검색시간 단축이 가능함
    - 단점 : 내부 노드의 크기가 증가
- 
- 이전 B-트리는 노드의 각 키가 하위 레벨의 노드에서 중복이 간읗마
    - 단말 노드들은 완전한 인덱스 구성

![스크린샷 2023-11-22 14.42.50.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.42.50.png)

m이 차수일 때 모든 노드는 m개의 자손노드(키)를 가진다.

루트와 단만 노드 이외의 모든 노드는 최소 m/2개 이상 자손 노드를 가진다.

루트노드는 예외적으로 2개의 자손 노드를 가줄 수 있다.

<aside>
💡 최악의 검색 깊이

</aside>

![스크린샷 2023-11-22 14.50.16.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.50.16.png)

자손 노드의 최소 수는 루트의 경우 2개

그 하위는 2 * [m/2]개

d 레벨에서 2*[m/2]^ d -1 개는 리프노드를 말한다.

N개 키를 가지는 B-트리의 경우, N ≥ 2* [m/2]^d-1

![스크린샷 2023-11-22 14.55.42.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.55.42.png)

**차수가 512인 1,000,000개의 키에 대해서 disk i/O 횟수는**

- 최악의 디스크 i/o 수는 3.37번

![스크린샷 2023-11-22 14.52.49.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_14.52.49.png)

![스크린샷 2023-11-22 15.12.10.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.12.10.png)

![스크린샷 2023-11-22 15.13.20.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.13.20.png)

![스크린샷 2023-11-22 15.14.25.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.14.25.png)

H 삭제 시 delete → underflw → merge ) 디모션 한다.  프로모션의 반대 의미다.

예외 상황도 있다

차수가 5인 b-tree

머지 할 때는 왼쪽을 우선으로 한다.

![스크린샷 2023-11-22 15.18.05.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.18.05.png)

EX) W를 삭제하면 ?

해당 노드에서 노드가 남는다 (공간 사용 현황이 50% 아래로 내려간다.)

 

![Untitled](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/Untitled.jpeg)

EX) M을 삭제 하면?

EX) D를 삭제한다.

![스크린샷 2023-11-22 15.24.21.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.24.21.png)

재분배 우선 삽입 방법

![스크린샷 2023-11-22 15.26.11.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.26.11.png)

꽉 찬 2개를 3개로 insert 함

재분배 우선 방식을 사용하면 대략 70% 의 공간 활욜률을 보일 수 있다.

![스크린샷 2023-11-22 15.38.15.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.38.15.png)

![스크린샷 2023-11-22 15.39.36.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.39.36.png)

- 루트 노드는 최소한 2개의 자손 노드를 가진다.
- 모든 단말 노드는 동일 레벨을 가짐

![스크린샷 2023-11-22 15.43.52.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.43.52.png)

![스크린샷 2023-11-22 15.45.20.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.45.20.png)

루드에 가까운 키들은 LRU 대체 알고리즘에 의해

자주 access 되니. 캐쉬에서 쫒겨날 일이 거의 없다.

![스크린샷 2023-11-22 15.51.23.png](11%2024%20(%E1%84%89%E1%85%AE)%2012week1%20e5271a61785c4af382faf7e2223eb146/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-22_15.51.23.png)

해당 방법과 비슷한 방법은

레벨 값이 낮을 수록 버퍼에서 안쫒겨 나도록 설계한다.