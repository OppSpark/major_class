# 11.08.(수) 10week1

<aside>
💡 이진탐색과 내부정렬의 한계

</aside>

![스크린샷 2023-11-08 14.03.47.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.03.47.png)

![스크린샷 2023-11-08 14.04.10.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.04.10.png)

9.5번은 너무 많아서 사용하기 힘듦

고정 길이 레코드

![스크린샷 2023-11-08 14.05.38.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.05.38.png)

KEYNODES  : 배열임

RRN :  주소 ( 데이터 번호 )

정렬 과정

- 디스크에서 필요한 정보를 램으로 읽어온다.
- 램에서 정렬을 진행함
- 정렬한 데이터를 디스크에 쓰기

위 데이터를 정렬하면

아래 PPT 처럼 바뀐다.

![스크린샷 2023-11-08 14.09.43.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.09.43.png)

K개 레코드 수를 정렬하는데 필요한 disk i/o 수

- K번

K개 레코드 수를 정렬하고 저장하는데 필요한 disk i/o 수

- 3 *  K 번

키 정렬의 할 경우
랜덤 접근(random seeks) 할 경우 속도가 매우 느리다. 

![스크린샷 2023-11-08 14.14.18.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.14.18.png)

![스크린샷 2023-11-08 14.19.01.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.19.01.png)

<aside>
💡 키 정렬 방식의 한계

</aside>

**랜덤 디스크 접근(random disk access)**

- 정렬된 키 값에서 랜덤으로 탐색 시 속도가 매우 느리다.

**키값과 RRN의 수가 메모리에 적재되기 힘들만큼 크다면?**

- 크기가 커서 내부정렬 불가

![스크린샷 2023-11-08 14.24.00.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.24.00.png)

키값이 너무 크면 

- RRN 만 램에 정렬해서 필요한 데이터를 검색 하고 디스크에서 데이터를 가져온다.

인덱스파일 

- 검색에 필요한 키값(데이터)의 주소

****

![스크린샷 2023-11-08 14.23.53.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.23.53.png)

<aside>
💡 Pinned 레코드

</aside>

개념 

- 레코드의 물리적인 주소에 대한 값을 누군가가 사용할 때를 Pinned 라고 한다.
- 어떤 레코드의 주소가 다른곳에서 이용하고 있을때, 레코드가 Pinned 되었다.

Pinned 레코드는 이동이 불가능하다.

- Pinned 레코드의 위치가 변경되면 이 레코드에 대한 참조는 dangling pointer 가 됨
    - 엉뚱한 것을 참조 할 수도 있음

Pinned 를 최소화 하는 것이 중요함

<aside>
💡 7장 인덱싱

</aside>

![스크린샷 2023-11-08 14.32.20.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.32.20.png)

인덱스란?

- 키값과 레코드 주소가 하나의 엔트리면. 이것들의 배열을 인덱스라고한다.

![스크린샷 2023-11-08 14.43.07.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.43.07.png)

도서관의 카드 카탈로그 같은 것

저자 이름이 key 값인 인덱스

제목이 key 값인 인덱스

등등 

키 값은 정렬이 되어있어야한다.

![스크린샷 2023-11-08 14.46.25.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.46.25.png)

가변길이로 저장했다고 가정

레코드 주소 : 파일상 시작 주소

아래 PPT 

위 파일을 index화 시킴

![스크린샷 2023-11-08 14.48.50.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.48.50.png)

키는 정렬된 상태로 저장된다.

키값이 FF245인 주소를 찾겠다.

- index에서 FF245를 검색
- 해당 주소를 찾아서 읽음

키를 검색하는 과정

1. FF245를 RAM 에서 검색함
2. 검색을하면 

램에서 관리하는 것 3가지

1. Search(key) 키 검색

EX) 삽입 방법

EE123, 999를 insert 하는 법

EE123을 삽입 정렬하고

나머지는 한칸씩 밑으로 내린다.(재배치)

EX) 삭제 방법

해당 값 아래에 있는 값을 한칸씩 위로 올린다.

키값이 Unique = true 면

- 검색하면서 해당 값을 찾으면 그 값을 선택하면됨

![스크린샷 2023-11-08 14.50.45.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.50.45.png)

![스크린샷 2023-11-08 14.58.36.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_14.58.36.png)

데이터 파일을 사용하는 과정

1. 인덱스 파일을 메모리(TextIndex)에 적재한다
2. 메모리에서 검색한다.

여기서 디스크에서 메모리로 파일을 적재할 때 TextIndexBuffer 가 이용된다. (버퍼)

(Open 매소드) : 인덱스 파일을 적재

(Close 매소드) : 인덱스 파일로 적재

만약 읽기 쓰기를 반복하다

램에 있는 index 와 디스크의 index가 달라졌는데

정전이 발생해서 래 데이터가 날라갔다면?

- index를 다시 만들면 된다.

해결 방법 디스크에 boolean을 사용해서 해서 flag 변경이 되었는지 확인함

레코드 사이에 추가하기 /시험에 나올 수 있음/

시발 

100바이트 공간에 110바이트를 저장하는 법

[    200byte    ][ 100byte ][      n byte      ][      빈 공간      ]

100byte 공간에 110바이트를 저장 하려면

뒤 n 바이트 공간을 10byte 씩 뒤로 밀거나 

100바이트를 저장하고 나머지 값은 다른 공간에 저장한다.

- 여기서 100byte 저장 공간 끝에 다른 공간 주소를 포함함

![스크린샷 2023-11-08 15.33.59.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_15.33.59.png)

![스크린샷 2023-11-08 15.33.52.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_15.33.52.png)

![스크린샷 2023-11-08 15.33.42.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_15.33.42.png)

![스크린샷 2023-11-08 15.46.24.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_15.46.24.png)

![스크린샷 2023-11-08 15.46.33.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_15.46.33.png)

![스크린샷 2023-11-08 15.46.54.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_15.46.54.png)

index를 하나의 레코드에 전부 저장하는 것이 아닌 index를 몇 개 씩 묶어서 여러군데에 저장하는 방법도 있음

- 그 이유는 레코드길이가  고정길이에서 가변 길이로 저장할 수 있기 때문

![스크린샷 2023-11-08 15.52.15.png](11%2008%20(%E1%84%89%E1%85%AE)%2010week1%2090c94f89507a412c8bf06a92ec6701ef/%25E1%2584%2589%25E1%2585%25B3%25E1%2584%258F%25E1%2585%25B3%25E1%2584%2585%25E1%2585%25B5%25E1%2586%25AB%25E1%2584%2589%25E1%2585%25A3%25E1%2586%25BA_2023-11-08_15.52.15.png)

해결책 

tree structured 사용